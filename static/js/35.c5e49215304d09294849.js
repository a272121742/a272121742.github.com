(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{ABAt:function(t,e,a){},cAvP:function(t,e,a){"use strict";var n=a("ABAt");a.n(n).a},p8BH:function(t,e,a){"use strict";a.r(e);function n(){var a=this,t=a.$createElement,n=a._self._c||t;return n("keep-alive",[n("div",{staticClass:"editor"},[n("div",{staticClass:"top-container"},[n("div",{ref:"toolbar",staticClass:"toolbar"},[n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("撤销")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-undo",attrs:{"data-command":"undo"}})]),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("重做")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-redo disable",attrs:{"data-command":"redo"}})]),a._v(" "),n("a-divider",{attrs:{type:"vertical"}}),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("复制")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-copy-o",attrs:{"data-command":"copy"}})]),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("粘贴")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-paster-o disable",attrs:{"data-command":"paste"}})]),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("删除")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-delete-o",attrs:{"data-command":"delete"}})]),a._v(" "),n("a-divider",{attrs:{type:"vertical"}}),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("放大")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-zoom-in-o",attrs:{"data-command":"zoomIn"}})]),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("缩小")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-zoom-out-o",attrs:{"data-command":"zoomOut"}})]),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("适应画布")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-fit",attrs:{"data-command":"autoZoom"}})]),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("实际尺寸")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-actual-size-o",attrs:{"data-command":"resetZoom"}})]),a._v(" "),n("a-divider",{attrs:{type:"vertical"}}),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("层级后置")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-to-back",attrs:{"data-command":"toBack"}})]),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("层级前置")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-to-front",attrs:{"data-command":"toFront"}})]),a._v(" "),n("span",{staticClass:"separator"}),a._v(" "),n("a-tooltip",{attrs:{placement:"bottom"},scopedSlots:a._u([{key:"title",fn:function(){return[n("span",[a._v("多选")])]},proxy:!0}])},[a._v(" "),n("i",{staticClass:"command iconfont icon-select",attrs:{"data-command":"multiSelect"}})])],1),a._v(" "),n("div",{staticClass:"data-opt"},[n("a-button",{attrs:{size:"small",type:"primary"},on:{click:a.download}},[a._v("\n          下载\n        ")]),a._v(" "),n("a-button",{attrs:{size:"small",type:"primary",disabled:a.disableSave},on:{click:a.save}},[a._v("\n          保存\n        ")])],1)]),a._v(" "),n("div",{staticClass:"bottom-container"},[n("div",{staticClass:"left-pannel"},[n("div",{ref:"itempannel",staticClass:"itempannel-container"},[Object.keys(a.itemGroup).length?n("a-collapse",{attrs:{"active-key":a.activeKey,bordered:!1}},a._l(a.itemGroup,function(t,e){return n("a-collapse-panel",{key:e,attrs:{header:e}},[t&&t.length?a._l(t,function(t){return n("a-popover",{key:t.name,attrs:{placement:"right"},scopedSlots:a._u([{key:"content",fn:function(){return[a._t("default",null,{item:t})]},proxy:!0}],null,!0)},[a._v(" "),n("img",{staticClass:"getItem",attrs:{src:"/static/images/example.png",draggable:"false","data-type":"node","data-shape":t.name,"data-size":"102*102","data-color":"#FA8C16","data-label":t.name}})])}):a._e()],2)}),1):a._e()],1)]),a._v(" "),n("div",{staticClass:"center-pannel"},[n("div",{ref:"flow",staticClass:"flow"}),a._v(" "),n("div",{ref:"contextmenu",staticClass:"contextmenu",staticStyle:{position:"absolute","z-index":"2"}},[n("div",{staticClass:"menu",staticStyle:{display:"none"},attrs:{"data-status":"node-selected"}},[n("div",{staticClass:"command iconfont icon-copy-o disable",attrs:{"data-command":"copy"}},[n("span",[a._v("复制")])]),a._v(" "),n("div",{staticClass:"command iconfont icon-delete-o disable",attrs:{"data-command":"delete"}},[n("span",[a._v("删除")])])]),a._v(" "),n("div",{staticClass:"menu",staticStyle:{display:"none"},attrs:{"data-status":"edge-selected"}},[n("div",{staticClass:"command iconfont icon-delete-o disable",attrs:{"data-command":"delete"}},[n("span",[a._v("删除")])])]),a._v(" "),n("div",{staticClass:"menu",staticStyle:{display:"none"},attrs:{"data-status":"group-selected"}},[n("div",{staticClass:"command iconfont icon-copy-o disable",attrs:{"data-command":"copy"}},[n("span",[a._v("复制")])]),a._v(" "),n("div",{staticClass:"command iconfont icon-delete-o disable",attrs:{"data-command":"delete"}},[n("span",[a._v("删除")])])]),a._v(" "),n("div",{staticClass:"menu",staticStyle:{display:"block"},attrs:{"data-status":"canvas-selected"}},[n("div",{staticClass:"command iconfont icon-undo disable",attrs:{"data-command":"undo"}},[n("span",[a._v("撤销")])]),a._v(" "),n("div",{staticClass:"command iconfont icon-redo disable",attrs:{"data-command":"redo"}},[n("span",[a._v("重做")])]),a._v(" "),n("div",{staticClass:"command iconfont icon-paster-o disable",attrs:{"data-command":"pasteHere"}},[n("span",[a._v("粘贴")])])]),a._v(" "),n("div",{staticClass:"menu",staticStyle:{display:"none"},attrs:{"data-status":"multi-selected"}},[n("div",{staticClass:"command iconfont icon-copy-o disable",attrs:{"data-command":"copy"}},[n("span",[a._v("复制")])]),a._v(" "),n("div",{staticClass:"command iconfont icon-paster-o disable",attrs:{"data-command":"paste"}},[n("span",[a._v("粘贴")])]),a._v(" "),n("div",{staticClass:"command iconfont icon-delete-o disable",attrs:{"data-command":"delete"}},[n("span",[a._v("删除")])])])])]),a._v(" "),n("div",{staticClass:"right-pannel"},[n("div",{staticClass:"detail-pannel"},[n("div",{ref:"detailpannel"},[n("div",{staticClass:"pannel",staticStyle:{display:"none"},attrs:{"data-status":"node-selected"}},[n("div",{staticClass:"pannel-title"},[a._v("\n                节点\n              ")]),a._v(" "),n("div",{staticClass:"block-container"},[n("div",{staticClass:"p name"},[a._v("\n                  名称：\n                  "),n("a-input",{attrs:{size:"small"},model:{value:a.nodeName,callback:function(t){a.nodeName=t},expression:"nodeName"}})],1)])]),a._v(" "),n("div",{staticClass:"pannel",staticStyle:{display:"none"},attrs:{"data-status":"edge-selected",id:"edge_detailpannel"}},[n("div",{staticClass:"pannel-title"},[a._v("\n                边\n              ")]),a._v(" "),n("div",{staticClass:"block-container"},[n("div",{staticClass:"p name"},[a._v("\n                  名称：\n                  "),n("a-input",{attrs:{size:"small"},model:{value:a.edgeName,callback:function(t){a.edgeName=t},expression:"edgeName"}})],1)])]),a._v(" "),n("div",{staticClass:"pannel",staticStyle:{display:"none"},attrs:{"data-status":"canvas-selected",id:"canvas_detailpannel"}},[n("div",{staticClass:"pannel-title"},[a._v("\n                画布\n              ")]),a._v(" "),n("div",{staticClass:"block-container"},[n("a-checkbox",{on:{change:a.changeGridShowOrHide}},[a._v("\n                  显示网格\n                ")])],1)]),a._v(" "),n("div",{staticClass:"pannel",staticStyle:{display:"block"},attrs:{"data-status":"multi-selected",id:"multi_detailpannel"}},[n("div",{staticClass:"pannel-title"},[a._v("\n                多选\n              ")]),a._v(" "),n("div",{staticClass:"block-container"},[n("div",{staticClass:"p color"},[a._v("\n                  颜色：\n                  "),n("a-input",{attrs:{size:"small"},model:{value:a.multiColor,callback:function(t){a.multiColor=t},expression:"multiColor"}})],1)])])])]),a._v(" "),n("div",{staticClass:"navigator"},[n("span",{staticClass:"pannel-title"},[a._v("导航器")]),a._v(" "),n("div",{ref:"minimap",staticClass:"mini-map"})]),a._v(" "),n("div",{staticClass:"zoom-slider"},[n("a-slider",{attrs:{"show-input":"","input-size":"mini",value:a.zoomRatio,min:50,max:200,"tip-formatter":a.formatTooltip},on:{change:a.changeZoomRatio}})],1)])])])])}n._withStripped=!0;var o=a("RIqP"),i=a.n(o),s=a("J4zp"),l=a.n(s),d=a("8zrh"),c=a("CKn+"),r=a("Fojh"),m=a.n(r);window.G6Editor=m.a;m.a.Util;m.a.registerEdge("custom-flow-polyline-round",{afterDraw:function(t){var e=t.group.get("children")[0];console.log("拖拽线条后，可用于重绘线条",e)}},"flow-polyline-round");var p={name:"BaseFlow",components:{},props:{data:{type:Object,default:function(){return{}}},items:{type:Array,default:function(){return[]}},dataMapping:{type:Function,default:function(){}}},data:function(){return{editor:null,page:null,flow:null,graph:null,nodeId:null,nodeName:null,nodeWidth:null,nodeHeight:null,nodeColor:null,groupId:null,groupName:null,groupColor:null,edgeId:null,edgeName:null,multiId:[],multiColor:null,isMultiSelect:!1,zoomRatio:100,itemGroup:{"":[]},activeKey:"",disableSave:!0}},watch:{nodeName:function(t){this.flow.update(this.nodeId,{label:t})},nodeWidth:function(t){this.flow.update(this.nodeId,{size:"".concat(t,"*").concat(this.nodeHeight)})},nodeHeight:function(t){this.flow.update(this.nodeId,{size:"".concat(this.nodeWidth,"*").concat(t)})},multiColor:function(e){var a=this;this.multiId.forEach(function(t){a.flow.update(t,{color:e})})},nodeColor:function(t,e){null!==e&&this.flow.update(this.nodeId,{color:t})},edgeName:function(t){null!==t&&this.flow.update(this.edgeId,{label:{text:t}})},groupName:function(t){null!==t&&this.flow.update(this.groupId,{label:t})},groupColor:function(t){null!==t&&this.flow.update(this.groupId,{color:t})},zoomRatio:function(t){this.graph.zoom(t/100)},data:function(t){this.flow.read(this.data)},items:function(t){this.initItems()},itemGroup:function(t){this.activeKey=Object.keys(t)[0]||""}},created:function(){},mounted:function(){this.initEditor(),window.vm=this},activated:function(){this.initItems(),this.data&&this.flow.read(this.data)},methods:{initEditor:function(){var t=new m.a;this.editor=t,m.a.track(!1),this.flow=new m.a.Flow({graph:{container:this.$refs.flow,minZoom:.5,maxZoom:2},align:{grid:!0},grid:{cell:20},shortcut:{zoomIn:!0,zoomOut:!0},noEndEdge:!1}),this.itempannel=new m.a.Itempannel({container:this.$refs.itempannel}),this.minimap=new m.a.Minimap({container:this.$refs.minimap}),this.toolbar=new m.a.Toolbar({container:this.$refs.toolbar}),this.contextmenu=new m.a.Contextmenu({container:this.$refs.contextmenu}),this.detailpannel=new m.a.Detailpannel({container:this.$refs.detailpannel}),t.add(this.flow),t.add(this.itempannel),t.add(this.minimap),t.add(this.toolbar),t.add(this.contextmenu),t.add(this.detailpannel),this.upClarity(1.5),this.data&&this.flow.read(this.data),this.graph=this.flow.getGraph(),this.graph.setFitView("cc"),this.page=t.getCurrentPage(),this.page.hideGrid(),this.graph.edge({shape:"custom-flow-polyline-round",style:{stroke:"#79838e"},labelRectStyle:{fill:"#ffffff"}}),this.page.changeAddEdgeModel({shape:"flow-polyline-round"}),this.listenCommand(),this.listenEvent()},initItems:function(){var s=this.dataMapping;this.items.forEach(function(i){m.a.Flow.registerNode(i.name,{draw:function(t){s(t,i);var e=t.getGraphicGroup(),a=t.getModel(),n=e.addShape("rect",{attrs:{x:-50,y:-50,width:100,height:100}});e.addShape("image",{attrs:{x:-50,y:-50,width:100,height:100,img:"/static/images/example.png"}});var o=a.label;return e.addShape("text",{attrs:{text:o,x:0,y:64,textAlign:"center",textBaseline:"middle",fill:"rgba(0, 0, 0, 0.85)"}}),n},anchor:i.anchors})}),this.$set(this,"itemGroup",Object(d.a)(Object(c.a)("group"),this.items))},listenCommand:function(){var a=this;this.editor.on("beforecommandexecute",function(t){a.getItems()}),this.editor.on("aftercommandexecute",function(t){var e=t.command.name;"multiSelect"===e?(a.multiId=[],a.isMultiSelect=!0):"undo"===e&&(a.isMultiSelect=!1)})},listenEvent:function(){var n=this;this.page.on("afteritemselected",function(t){switch(t.item.type){case"node":if(n.isMultiSelect)n.multiId.push(t.item.model.id),n.multiColor=t.item.model.color;else{n.nodeId=t.item.model.id,n.nodeName=t.item.model.label;var e=t.item.model.size.split("*"),a=l()(e,2);n.nodeWidth=a[0],n.nodeHeight=a[1],n.nodeColor=t.item.model.color}break;case"edge":n.edgeId=t.item.model.id,n.edgeName=t.item.model.label?t.item.model.label.text:null;break;case"group":n.groupId=t.item.model.id,n.groupName=t.item.model.label?t.item.model.label:null,n.groupColor=t.item.model.color?t.item.model.color:"#f2f4f5"}}),this.page.on("beforeitemunselected",function(){n.isMultiSelect=!1}),this.page.on("node:dblclick",function(t){n.$emit("node:dbClick",t)}),this.page.on("dragedge:beforeshowanchor",function(t){t.source===t.target&&(t.cancel=!0),t.sourceAnchor.type===t.targetAnchor.type&&(t.cancel=!0),(n.page.anchorHasBeenLinked(t.source,t.sourceAnchor)||n.page.anchorHasBeenLinked(t.target,t.targetAnchor))&&(t.cancel=!0)}),this.graph.on("afterrender",function(t){n.$emit("render",n.getNodes())}),this.graph.on("afterchange",function(t){n.disableSave=!1}),this.graph.on("afterchangesize",function(){n.graph.update()}),this.graph.on("afterzoom",function(t){n.zoomRatio=100*t.updateMatrix[0]}),this.page.on("edge:mouseenter",function(t){t.item.isSelected||function(t){t.attr("stroke","#1890ff"),t.attr("lineWidth",2)}(t.shape)}),this.page.on("edge:mouseleave",function(t){t.item.isSelected||function(t){t.attr("stroke","#79838e"),t.attr("lineWidth",1)}(t.shape)})},save:function(){var t=this.flow.save();this.$emit("saved",t,{nodes:this.getNodes(),edges:this.getEdges()}),this.disableSave=!0},getItems:function(){return[].concat(i()(this.getNodes()),i()(this.getEdges()))},getEdges:function(){return this.graph.getEdges()},getNodes:function(){return this.graph.getNodes()},changeGridShowOrHide:function(t){t.target.checked?this.page.showGrid():this.page.hideGrid()},changeZoomRatio:function(t){this.zoomRatio=t},download:function(){this.page.hideGrid(),this.graph.setFitView("cc");var t=this.$refs.flow.childNodes[0].childNodes[0].toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="download.png",e.click(),e.remove()},formatTooltip:function(t){return"缩放比".concat(t,"%")},upClarity:function(t){var e=this.$refs.flow.childNodes[0].childNodes[0],a=Number(t)||1.5,n=window.devicePixelRatio&&window.devicePixelRatio>=a?window.devicePixelRatio:a,o=e.getBoundingClientRect();e.width=o.width*n,e.height=o.height*n,e.getContext("2d").scale(n,n)}}},u=(a("cAvP"),a("KHd+")),h=Object(u.a)(p,n,[],!1,null,"5b877872",null);h.options.__file="src/components/G6Editor/BaseFlow.vue";e.default=h.exports}}]);
//# sourceMappingURL=35.c5e49215304d09294849.js.map